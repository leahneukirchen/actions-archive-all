name: x

on: push

jobs:
  lurch:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          repository: gkdr/lurch
          ref: 'v0.7.0'
          path: repo
          submodules: true
      - uses: leahneukirchen/actions-archive-all@v0
        id: archive_all
        with:
          dir: repo
          name: lurch-v0.7.0
      - run: echo ${{ join(steps.archive_all.outputs.*, ':') }}
      - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: lurch-v0.7.0
          body: |
            ${{ steps.archive_all.outputs.sha256 }}
      - uses: actions/upload-release-asset@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./${{ steps.archive_all.outputs.archive }}
          asset_name: ${{ steps.archive_all.outputs.archive }}
          asset_content_type: application/gzip
